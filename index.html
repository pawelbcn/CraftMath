<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CraftMath - Multiplication Tables</title>
    <meta name="description" content="Interactive educational game for learning multiplication tables in pixel art style.">
    <meta name="author" content="Pawel Marciniak">
    <meta name="theme-color" content="#2d2d2d">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="CraftMath">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <script src="translations.js"></script>
    <style>
        @font-face {
            font-family: 'PixelFont';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/font-minecraft/5.8.1/font-minecraft.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        body {
            font-family: 'PixelFont', monospace;
            background-color: #8b8b8b;
            background-image: linear-gradient(rgba(0, 0, 0, 0.2) 1px, transparent 1px),
                             linear-gradient(90deg, rgba(0, 0, 0, 0.2) 1px, transparent 1px);
            background-size: 32px 32px;
            text-align: center;
            margin: 0;
            padding: 20px;
            image-rendering: pixelated;
            color: white;
            text-shadow: 2px 2px #000000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .language-selection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .language-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            padding: 20px;
            background-color: #5c5c5c;
            border: 4px solid #2d2d2d;
            box-shadow: 0 0 0 4px #7e7e7e;
            max-width: 800px;
            width: 90%;
        }
        .language-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background-color: #546454;
            border: 4px solid #2d3a2d;
            cursor: pointer;
            transition: all 0.2s;
            color: white;
            text-shadow: 2px 2px #000000;
        }
        .language-button:hover {
            background-color: #48a248;
            transform: translateY(-5px);
        }
        .language-button.active {
            border-color: #ffff55;
        }
        .flag-image {
            width: 60px;
            height: 40px;
            margin-bottom: 10px;
            border: 2px solid #2d2d2d;
        }
        .language-name {
            font-size: 14px;
            text-transform: uppercase;
        }
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #5c5c5c;
            border: 4px solid #2d2d2d;
            padding: 20px;
            box-shadow: 0 0 0 4px #7e7e7e;
            position: relative;
        }
        @media (max-width: 768px) {
            .language-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            body {
                padding: 10px;
            }
        }
        @media (max-width: 480px) {
            .language-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .flag-image {
                width: 45px;
                height: 30px;
            }
            .language-name {
                font-size: 12px;
            }
        }
        [dir="rtl"] {
            direction: rtl;
            text-align: right;
        }
        /* Rest of the existing styles from gra.html */
    </style>
</head>
<body>
    <div id="languageSelection" class="language-selection">
        <div class="language-grid">
            <div class="language-button" onclick="setLanguage('en')">
                <img src="flags/en.png" alt="English" class="flag-image">
                <span class="language-name">English</span>
            </div>
            <div class="language-button" onclick="setLanguage('pl')">
                <img src="flags/pl.png" alt="Polski" class="flag-image">
                <span class="language-name">Polski</span>
            </div>
            <div class="language-button" onclick="setLanguage('zh')">
                <img src="flags/zh.png" alt="中文" class="flag-image">
                <span class="language-name">中文</span>
            </div>
            <div class="language-button" onclick="setLanguage('hi')">
                <img src="flags/hi.png" alt="हिंदी" class="flag-image">
                <span class="language-name">हिंदी</span>
            </div>
            <div class="language-button" onclick="setLanguage('es')">
                <img src="flags/es.png" alt="Español" class="flag-image">
                <span class="language-name">Español</span>
            </div>
            <div class="language-button" onclick="setLanguage('ar')">
                <img src="flags/ar.png" alt="العربية" class="flag-image">
                <span class="language-name">العربية</span>
            </div>
            <div class="language-button" onclick="setLanguage('bn')">
                <img src="flags/bn.png" alt="বাংলা" class="flag-image">
                <span class="language-name">বাংলা</span>
            </div>
            <div class="language-button" onclick="setLanguage('fr')">
                <img src="flags/fr.png" alt="Français" class="flag-image">
                <span class="language-name">Français</span>
            </div>
            <div class="language-button" onclick="setLanguage('de')">
                <img src="flags/de.png" alt="Deutsch" class="flag-image">
                <span class="language-name">Deutsch</span>
            </div>
            <div class="language-button" onclick="setLanguage('it')">
                <img src="flags/it.png" alt="Italiano" class="flag-image">
                <span class="language-name">Italiano</span>
            </div>
            <div class="language-button" onclick="setLanguage('pt')">
                <img src="flags/pt.png" alt="Português" class="flag-image">
                <span class="language-name">Português</span>
            </div>
            <div class="language-button" onclick="setLanguage('nl')">
                <img src="flags/nl.png" alt="Nederlands" class="flag-image">
                <span class="language-name">Nederlands</span>
            </div>
        </div>
    </div>

    <div id="gameContainer" class="game-container" style="display: none;">
        <!-- Game content will be dynamically inserted here -->
    </div>

    <script>
        // Initialize language from localStorage or show language selection
        const currentLang = localStorage.getItem('craftmath-lang');
        if (currentLang) {
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            document.documentElement.lang = currentLang;
            if (currentLang === 'ar') {
                document.documentElement.dir = 'rtl';
            }
        }

        function setLanguage(lang) {
            localStorage.setItem('craftmath-lang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('languageSelection').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            initializeGame(); // Function to start the game with selected language
        }

        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed', err));
        }

        // Rest of the game logic from gra.html
    </script>
</body>
</html>